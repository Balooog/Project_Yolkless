# PX-021.1 — Environmental Simulation Layer
**Targets:** RM-021  
**Date:** 2025-10-22  
**Outcome:** Active

## Driver Prompt
# Project Yolkless – PX-021.1  
### Environmental Simulation Layer (Targets RM-021)

---

## 1. Scope
Build a reactive environment service that models temperature, light level, humidity, and air quality. These factors gently influence power efficiency, feed consumption, and prestige ambience while coordinating visual/audio cues across the day/night cycle.

## 2. Functional Objectives
1. **Environment Service**
   - `EnvironmentService.gd` tracks factors over time using designer-authored curves and seasonal presets.
   - Supports manual overrides for testing and prestige-tier variants (e.g., Space Colony stability).
2. **Power Integration**
   - Temperature modifies generator efficiency via RM-018 hooks.
   - Light level affects solar output or mood lighting modifiers.
3. **Factory Effects**
   - Humidity tweaks feed consumption rates (RM-011) and automation thresholds (RM-013).
   - Air quality improves with wisdom (RM-015) and influences prestige bonuses.
4. **Presentation Layer**
   - Update top-banner weather icon and expand-to-panel UI (RM-010).
   - Drive visual, audio, and lighting cues (RM-020) for day/night transitions.
5. **Data Authoring**
   - Store seasonal curves in `data/environment_curves.tsv`.
   - Provide tooling hooks to preview timelines and export telemetry (RM-014).

## 3. Architecture Notes
- Service runs as an autoload singleton with signals (`environment_updated`, `day_phase_changed`).
- Each factor has configurable range clamps, easing functions, and prestige modifiers.
- Integrate with save system to persist cycle state across sessions.
- Ensure headless simulations can advance environment normally for balance testing.
- Merge legacy Environment Director behavior into this service; deprecate outdated scripts/docs.

## 4. Acceptance Criteria
1. Environment factors evolve according to configured curves and respond to prestige season selections.
2. Power and feed systems receive modifier callbacks and apply them without destabilizing the economy.
3. UI weather icon reflects current conditions; expanding panel lists factor values with tooltips.
4. Visual/audio cues respond smoothly to transitions without abrupt jumps.
5. Environment state saves/loads correctly and emits telemetry for QA baseline comparisons.

## 5. Deliverables
- `/src/services/EnvironmentService.gd`
- `data/environment_curves.tsv` with seasonal/presige presets.
- UI widget `ui/widgets/EnvPanel.tscn` and HUD integration updates.
- Updated docs in `/docs/roadmap/RM-021.md` and migration notes replacing Environment Director references.
- Headless simulation tests demonstrating environment impact logging.

## 6. Future Extensions
- Weather events tied into RM-016 event scheduler.
- Player-controlled climate sliders unlocked mid-prestige.
- Multi-biome support for future expansions.

**Linked Roadmap:** RM-021 – Environmental Simulation Layer  
**Branch Convention:** `feature/RM-021-environment`  
**Parent Epic:** World Atmosphere & Mood
