# PX-021.5 — Alternate Top-Down Map Renderer
**Targets:** RM-021**
**Status:** Planned**
**Branch:** `feature/PX-021.5-map`

## Goals
- Create a toggleable top-down visualization that reuses the sandbox CA buffer and EnvironmentService metrics to provide an infographic-style overview.
- Ensure instantaneous switching between Diorama and Map views without duplicating simulation logic.
- Encode Comfort Index, production rate, and environment signals into calm, legible map visuals suitable for timelapse and dashboards.

## Deliverables
- `scenes/sandbox/TopDownCanvas.tscn` and `src/sandbox/TopDownRenderer.gd` with shader/palette mapping of CA cells.
- View toggle in `Main.gd`/UI (button + auto-idle drift); `Config.sandbox_view` persistence.
- Map legend updates in `EnvPanel` (color/metric explanation).
- StatsProbe + dashboard updates (view mode tracking, `sandbox_render_ms_*`).
- Documentation refresh (module brief, Telemetry, UI principles).

## Mapping Rules
- PPS → pulsating brightness/halo on high-activity cells.
- CI → base hue gradient (greens calm ↔ reds stressed).
- Temperature → overlay gradient (warm/cool tint).
- Pollution (derived) → noise opacity mask.
- Automation level → motion vectors or icon density.

## Acceptance Criteria
1. Toggle between Diorama and Map completes ≤100 ms, with shared CA state.
2. Map encodes CI and PPS clearly; legend explains color mapping.
3. StatsProbe records `sandbox_render_ms` for map path, budgets ≤1 ms render.
4. Optional timelapse hook (placeholder script) writes map frames when enabled.
5. Auto-idle drift to map after 5 min with user input returning to Diorama.

## Non-Goals
- New sim metrics; pollution may be derived from existing factors.
- Advanced timelapse tools (covered in PX-014.3).
- Major UI redesign beyond toggle/legend.

## References
- [RM-021](../roadmap/RM-021.md)
- [PX-021.4](PX-021.4.md)
- [docs/modules/sandbox.md](../modules/sandbox.md)
- [docs/ux/UI_Principles.md](../ux/UI_Principles.md)
