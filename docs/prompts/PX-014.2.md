# PX-014.2 — CLI Replay & Performance Instrumentation
**Targets:** RM-014 — Telemetry & QA Pipeline  
**Date:** 2025-10-24  
**Outcome:** Planned  

## Scope
Deliver a deterministic headless replay tool with built-in performance instrumentation and scenario switching to support regression testing and dashboards.

## Objectives
1. Implement CLI entry point:  
   `godot --headless --path . --script res://tools/replay_headless.gd --duration=<sec> --seed=<int> [--strategy=<mode>]`.  
   Supported strategies: `normal`, `burst`, `idle`.  
2. Sample metrics every tick: `pps`, `ci`, `power_ratio`, `tick_ms`, `active_cells`.  
3. Write summary JSON to `logs/telemetry/replay_<timestamp>.json` with mean, p95, max per metric and scenario metadata.  
4. Emit CSV (optional flag) for quick spreadsheet analysis.  
5. Compare collected stats against `Performance_Budgets.md`; log WARN if thresholds exceeded.  
6. Provide helper script/test (`tests/replay/test_replay_headless.gd`) to validate deterministic seeds.  

## Deliverables
- `/tools/replay_headless.gd` — CLI driver.  
- `/tools/replay_strategies.gd` — strategy definitions.  
- `/tests/replay/test_replay_headless.gd`.  
- Documentation updates: `Telemetry_Replay.md`, `Performance_Budgets.md`.  

## Validation
- Running 300 s replay with default strategy produces identical JSON for identical seeds.  
- JSON includes comfort/power/shipment arrays and aggregated stats.  
- WARN log if any metric exceeds budget; otherwise INFO summary.  
- Execution completes under 2 × real time on target hardware.  
