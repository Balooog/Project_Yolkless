# Project Yolkless ‚Äì PX-011.1
### Early Economy Loop Tuning (Targets RM-011)

---

## 1) Scope
Tune the **opening 3‚Äì5 minutes** so players experience clear progress (earn, cap, dump, repeat) **without being able to buy any upgrades**.  Only core production, manual feeding, and storage interact.  Balance via `data/balance.tsv` with hot-reload (`R`) per scaffold.  Match timing and feedback to the comfort-idle ranges outlined in `docs/analysis/IdleGameComparative.md`.

> **Note (2025-10-24):** Subsequent pass [PX-011.2](PX-011.2.md) updates the early-shop pricing to match the live README guidance (Feeding Efficiency 50 ü•ö, Feed Silo 90 ü•ö). Keep this brief for historical context on the first tuning pass.

---

## 2) Objectives
1. **Pace**: Reach first storage cap in **60‚Äì120 s** with normal play (some manual feeding bursts).
2. **Loop**: At cap, a visible dump/sell tick triggers, resetting storage and continuing flow.
3. **No Upgrades**: All upgrade prices sit beyond reachable credits for 5 min of optimal play.
4. **Readability**: HUD shows PPS, storage %, and ‚ÄúCap Reached‚Äù pulse; diagnostic overlay confirms rates.
5. **Determinism**: With a fixed seed, simulated runs reproduce earnings ¬±2 %. (Use `Config.seed`.)

---

## 3) Economy Dial Targets
- **Base Passive PPS**: 0.40 credits/s (hands-off).
- **Manual Feed Burst**: x6 multiplier while holding, with feed drain limiting sustained burst to ~4 s then 6 s recovery.
- **Starting Storage**: 50 credits.
- **Dump Cadence**: Auto-sell every time storage hits 100 %; clear to 0 and continue.
- **Upgrade Price Floor**: First visible upgrades (`prod_1`, `cap_1`) priced so **unaffordable** until ‚â•6 minutes even with optimal bursts.

---

## 4) Balance Table Edits (proposed)
> Edit `data/balance.tsv` and reload in-session with **R**.

```tsv
# SECTION: CONSTANTS
KEY                       VAL      NOTES
BASE_PPS                  0.40     # passive credits per second at t0 (no upgrades)
MANUAL_FEED_MULT          6.0      # multiplier applied while feed is held
FEED_SUPPLY_MAX           100      # arbitrary units
FEED_SUPPLY_DRAIN_RATE    25       # units/s while feeding (‚âà4s max burst)
FEED_SUPPLY_REFILL_RATE   16       # units/s when idle (‚âà6s refill)
STORAGE_START             50       # starting storage capacity (credits)
STORAGE_SOFTCAP_CURVE     0.0      # no leak/decay pre-upgrades
DUMP_ON_FULL              1        # enable auto-dump at 100% storage
DUMP_ANIM_MS              300      # quick pulse on dump

# SECTION: PRICES (EARLY)
ID        TYPE     PRICE   VISIBLE  NOTES
prod_1    UPGRADE  250     1        # keep visible; unreachable in 3‚Äì5 min
cap_1     UPGRADE  320     1        # ditto
prod_2    UPGRADE  1200    0        # hidden until RM-012
cap_2     UPGRADE  1500    0        # hidden until RM-012

# SECTION: HUD FLAGS
SHOW_PPS_LABEL       1
SHOW_STORAGE_BAR     1
SHOW_CAP_PULSE       1
```

---

## 5) Logic & UI Nits (no new systems)

1. **Auto-Dump**: When `storage >= STORAGE_START`, enqueue a single ‚ÄúSell‚Äù event that:

   * Adds `storage` ‚Üí `credits`, sets `storage=0`, plays 300 ms pulse.
2. **Manual Feed** (existing input): While `feed_hold`:

   * `pps = BASE_PPS * MANUAL_FEED_MULT` **if** `feed_supply > 0`, drain; else fall back to `BASE_PPS`.
   * Off-hold: refill until `FEED_SUPPLY_MAX`.
3. **Diagnostics**: Ensure F3 overlay includes **PPS (current)**, **Storage (value/max)**, **Burst state**, **Seed** (already scaffolded).

---

## 6) Implementation Tasks

1. **Balance**: Apply `tsv` edits above.
2. **EconomyTick**: In the economy/autoload (existing singleton), add a guard for `DUMP_ON_FULL`.
3. **HUD Pulse**: Add a small tween/pulse on the storage bar when a dump occurs (no new art).
4. **Gate Prices**: Ensure the shop UI reads `VISIBLE` and `PRICE` from TSV; keep buttons disabled but tooltips active.
5. **Seeded Check**: Expose `Config.seed` field in the main scene (already supported) and set test seed to `12345` for QA.

---

## 7) Acceptance Criteria

1. **Cap timing**: With no input, first dump occurs in **2‚Äì3 minutes** (0.40 PPS ‚Üí ~120‚Äì180 s to 50).
   With reasonable bursts, first dump occurs in **60‚Äì120 s**.
2. **Early unlock**: Feeding Efficiency (`prod_1`, 50 ü•ö) is the **only** upgrade affordable immediately after the first shipment, matching README guidance.
3. **Gating**: Feed Silo (`feed_storage`, 90 ü•ö) comes online within ~5 minutes; higher-tier upgrades remain out of reach until the mid-game (‚â•140 credits).
4. **Loop clarity**: Storage bar fills, hits 100 %, pulses, and resets to 0 with credits increasing accordingly.
5. **Performance**: No frame drops or GC spikes during continuous hold/release.
6. **Determinism**: Two runs with `seed=12345` produce total credits within **¬±2 %** at t=300 s.
7. **Manual Ship Control**: Player can trigger ‚ÄúShip Now‚Äù for an immediate (reduced) payout; auto-dump remains available.

---

## 8) Deliverables

* **TSV**: `data/balance.tsv` (migrated from `game/data/balance.tsv`; keep constants + early prices updated)
* **Code**:

  * `src/economy/Economy.gd` ‚Äì add auto-dump logic (guarded by `DUMP_ON_FULL`)
  * `ui/hud/HudStorageBar.gd` ‚Äì add pulse tween on dump
* **Docs**:

  * `docs/prompts/PX-011.1.md` (this file)
  * `docs/notes/economy_early_loop.md` (1-pager with measured timings)
* **QA Tooling**:

  * `tools/headless_tick.sh <seconds>` ‚Äî run headless sim hooks (already scaffolded; keep usage)
  * `src/ci/econ_probe.gd` ‚Äî logs PPS, storage fill/dump timestamps to `logs/yolkless.log`

---

## 9) Test Plan (manual + headless)

1. **Hot-reload loop**: Run `./tools/run_dev.sh`, press **R**, verify values apply live.
2. **Hands-off timing**: No input from t=0; record first dump time. Expect 120‚Äì180 s.
3. **Burst timing**: Hold feed until supply empties; repeat cycles. Expect first dump ‚â§120 s.
4. **Five-minute credit check**: After 300 s of optimal bursting, total credits `< 250`.
5. **Seeded headless**: Launch headless with `Config.seed=12345`; run 300 s; verify totals within ¬±2 % across two runs.

---

## 10) Notes / Risks

* If players still reach 250 too quickly, raise **PRICE(prod_1)** to **300‚Äì350** and/or reduce **MANUAL_FEED_MULT ‚Üí 5.0**.
* If progress feels sluggish, lift **BASE_PPS ‚Üí 0.45** **or** drop **STORAGE_START ‚Üí 45** (keep first-cap under 2 min).
* Keep future work (automation, research) hidden until RM-012+ to avoid accidental unlocks.

---

**Repo touchpoints**: `balance.tsv` hot-reload, seed control, and scripts/tooling referenced in README.
**Branch**: `feature/RM-011-early-economy`
**Commit footer**:

```
RM: RM-011
PX: PX-011.1
```
