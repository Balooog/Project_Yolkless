# PX-021.2 — Sandbox Sampling & GPU Prep

## Goals
- Harden the SandboxService and SandboxGrid loop for higher-frequency sampling (2–5 Hz) with smoothing to support future GPU execution paths.
- Expose comfort telemetry snapshots suitable for replay automation.
- Preserve the 2 ms sandbox budget (see docs/quality/Performance_Budgets.md).

## Tasks
1. Add optional double-buffer smoothing hooks to `SandboxService` so active cell fractions and comfort deltas are averaged over the last N ticks (configurable in `environment_config.json`).
2. Capture per-tick timing by integrating `StatsProbe`:
   - `SandboxService` should call `StatsProbe.record_tick()` with `tick_ms` and `active_cells`.
   - `SimulationClock` should provide the delta to the probe so 10 Hz cadence is reflected in the CSV.
3. Update `docs/quality/Telemetry_Replay.md` with the new stats fields and guidance on interpreting `ci_delta` / `active_cells`.
4. Extend the replay JSON payload (`tools/replay_headless.gd`) to include sandbox timing, active cell metrics, and p95 comfort stability.

## Acceptance Criteria
- StatsProbe thresholds trigger alerts when sandbox tick >1.9 ms, `active_cells` exceeds 400, or `ci_delta` exceeds ±0.05 after the ~2 s warm-up window.
- Replay summaries include `sandbox_tick_ms_p95` and `active_cells_max` values.
- SandboxService exposes a smoothing configuration knob in `data/environment_config.json`.
- Telemetry docs capture the new metrics.

## Follow-up
- PX-021.3 will tackle GPU offload experimentation and the full comfort visualization overhaul.
