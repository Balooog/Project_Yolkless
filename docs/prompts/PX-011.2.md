# Project Yolkless ‚Äì PX-011.2
### First Purchase Unlock & Store Diagnostics (Targets RM-011)

---

## 1) Scope
Let the opening loop grant exactly **one intentional upgrade** around the 2‚Äì3 minute mark while keeping the rest of the shop locked until roughly the 5 minute milestone.  Layer on lightweight diagnostics so designers can see **why** buttons are disabled and whether auto-dump fires when storage caps.  Ensure pacing and messaging match the comfort-idle guidelines in `docs/analysis/IdleGameComparative.md`.

---

## 2) Objectives
1. **Early Win** ‚Äì `prod_1 / Feeding Efficiency L1` becomes affordable after 2‚Äì3 minutes of normal play.
2. **Sustain Gating** ‚Äì `cap_1` and all other upgrades stay unreachable until ‚â•5 minutes unless the player banks more than 140 credits.
3. **Truthful UI** ‚Äì Shop buttons render real prices (no ‚Äú0 üü°‚Äù), expose lock reasons in tooltips, and print state changes to the log.
4. **Economy Traceability** ‚Äì Storage hitting 100‚ÄØ% logs once, auto-dumps log the transfer, and credits tick upward immediately.

---

## 3) Balance Adjustments
| Upgrade ID | Label                        | Old Cost | New Cost | Notes |
|------------|-----------------------------|---------:|---------:|-------|
| `prod_1`   | Feeding Efficiency L1        | 250      | **50**   | First unlock target (buy right after first shipment). |
| `cap_1`    | Coop Capacity L1             | 320      | **140**  | Accessible after ~5 min. |
| `feed_storage` | Feed Storage L1         | 15       | 320      | Pushed beyond early reach. |
| `feed_refill`  | Feed Refill L1          | 20       | 280      | Ditto. |
| `feed_efficiency` | Feed Efficiency L1   | 30       | 360      | Ditto. |

Constants remain the same; `DUMP_ON_FULL` stays enabled to guarantee automatic sells.

---

## 4) Systems & UI Updates
1. **`ShopService.gd`** ‚Äì Centralizes visibility, pricing, and gating logic; emits change events with reason strings and stage data.
2. **`ShopDebug.gd`** ‚Äì Drop-in helper that logs the full shop state whenever it changes (`[ShopDebug] ‚Ä¶`).
3. **`Main.gd` wiring** ‚Äì Buttons now consume `ShopService` state, surface lock reasons in tooltips, and keep auto requirements in-line with stage names.
4. **`Economy.gd` instrumentation** ‚Äì Adds a one-shot ‚ÄúStorage full‚Äù log before each automatic dump, so designers can see when capacity is limiting flow.

---

## 5) Acceptance Criteria
1. At t‚âà150‚ÄØs the HUD shows ‚â•50 credits and `Feeding Efficiency L1` is clickable; purchase succeeds and price steps up (growth table).
2. `Coop Capacity L1` and all other upgrades stay disabled with tooltips like `Locked: need 50 more` or `Locked: requires Community Farm`.
3. Shop HUD never shows `0 üü°`; reload of `balance.tsv` hot-swap keeps prices aligned.
4. Console log captures paired lines: `Storage full reason=‚Ä¶` followed by `Auto shipment processed reason=auto` whenever storage caps during passive play.
5. `ShopDebug` output lists each upgrade with `reasons=[ok|‚Ä¶]` immediately after scene load and after any balance reload.

---

## 6) Deliverables
- `data/balance.tsv` ‚Äì Updated early upgrade costs (migrate from `game/data/balance.tsv`).
- `src/economy/Economy.gd` ‚Äì Storage-full logging toggle + auto-dump trace.
- `src/shop/ShopService.gd` ‚Äì New service for pricing & gating.
- `src/shop/ShopDebug.gd` ‚Äì Diagnostics helper.
- `game/scripts/Main.gd` ‚Äì Shop UI rewired to the service (migrate logic as needed).
- `docs/prompts/PX-011.2.md` ‚Äì This brief.

---

## 7) Validation Plan
1. **Hands-off run** ‚Äì Start a fresh save, let it idle; confirm first shipment logs and credits reach ‚â•50 before buying.
2. **Burst-assisted run** ‚Äì Use manual feeding to accelerate; verify `Feeding Efficiency L1` becomes available around 2 minutes, others still locked.
3. **Balance hot-reload** ‚Äì Press `R` (or reload via tools); watch `ShopDebug` output confirm new prices and reasons without restarting.
4. **Log review** ‚Äì Tail `logs/yolkless.log`; observe `Storage full` and `Auto shipment processed` entries in pairs.
5. **UI inspection** ‚Äì Hover disabled buttons to ensure tooltips explain the lock state and requirements.

---
