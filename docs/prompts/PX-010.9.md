# PX-010.9 — UI Visual Regression Harness
**Targets:** RM-010 — UI & Control Architecture  
**Branch:** `feature/RM-010-visual-regression`  
**Status:** Planned

## 1. Scope
Introduce automated screenshot baselines and comparison tooling so UI changes trigger pixel-diff alerts before shipping.

## 2. Objectives
1. Build `/tools/ui_baseline.sh` to run headless Godot captures for smoke scenes (`MainHUD`, `StorePanel`, `ResearchPanel`, `SandboxPanel`, `SettingsPanel`) at S and L breakpoints, saving PNGs under `dev/screenshots/ui_baseline/`.
2. Implement `/tools/ui_compare.sh` to diff current captures against baselines, failing when pixel difference exceeds 1% per viewport.
3. Create orchestrator `/tools/ui_viewport_matrix.sh` (refined from PX-010.4) to drive captures across defined resolution matrix.
4. Integrate harness into CI instructions (`docs/dev/Build_Cookbook.md` + README), outlining update flow when intentional UI changes occur.

## 3. Deliverables
- New tooling scripts (`ui_baseline.sh`, `ui_compare.sh`, updated `ui_viewport_matrix.sh`).
- Smoke scenes or exported scenes ready for capture under `scenes/ui_smoke/`.
- Documentation: instructions in `docs/dev/Build_Cookbook.md` and `docs/ux/UI_Principles.md`.

## 4. Acceptance Criteria
1. Running `ui_baseline.sh` produces deterministic PNGs for each smoke scene and breakpoint.
2. `ui_compare.sh` fails (non-zero exit) if intentional perturbation >1% detected.
3. CI instructions note baseline update procedure, including storage location and review checklist.
4. README (or dev docs) clarifies relationship between UILint and visual regression harness.

## 5. Tests & Validation
- Local dry run: capture baseline, modify UI to force diff, confirm `ui_compare.sh` reports failure.
- Spot-check PNGs for S (640×360) and L (1920×1080) to ensure cropping and scale consistent.

## 6. Dependencies
- Smoke scenes may reuse layout improvements (PX-010.4) and component atoms (PX-010.6).
- Harness supports later PX tasks (store usability, tooltip system).

## 7. Rollback Plan
- Remove scripts and CI hooks; restore manual screenshot process if needed.

## 8. Footers
```
RM: RM-010
PX: PX-010.9
```
