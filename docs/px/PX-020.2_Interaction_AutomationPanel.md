# PX-020.2 — Automation Panel Interaction & Wiring

> Extends the PX-013 automation HUD with explicit panel open/close feedback, target selection, and StatBus mirroring so automation intent is visible across UI, telemetry, and docs.

## Summary
- Define how the Automation Panel advertises its lifecycle through `automation_panel_opened`, `automation_panel_closed`, and `automation_target_changed(target_id)` signals (emitted by `UIArchitecturePrototype` and consumed by `Main.gd`, `AutomationService`, and telemetry probes).
- Ensure panel interactions update StatBus (`automation_target`) and HUD slots without delaying the calm pacing expected in PX-010 sheet designs.  The latest wiring routes panel selection into `AutomationService.set_panel_target`, which mirrors the string label on StatBus and StatsProbe.
- Provide UX notes for controller / keyboard focus, copy tone, and tooltip hooks so PX-020.3 can build on a stable frame.  Automation buttons continue to emit upgrade requests while also emitting dedicated target-change signals for telemetry.

## Goals
1. Capture panel state transitions so automation metrics can be replayed and audited without screen recordings.
2. Document focus + accessibility behaviors (e.g., which control regains focus when the panel closes) referencing [UI Baseline Layout Spec](../ui_baselines/README_UI_BASELINE_LAYOUT.md).
3. Clarify how automation choices change the economy/conveyor stats already surfaced in PX-020.1.

## Dependencies
- [PX-020.1 GUI Wiring](PX-020.1_GUI_Wiring.md) for stat definitions and HUD slots.
- [PX-013.2 Automation HUD and Scheduling Preview](../prompts/PX-013.2.md) for existing panel layout + data binding.
- [Signals & Events](../architecture/Signals_Events.md) and [StatBus Catalog](../architecture/StatBus_Catalog.md) to log the new automation events and stat keys.
- [Modules — Economy](../modules/economy.md) and [Modules — Conveyor](../modules/conveyor.md) for downstream effects on PPS/backlog.

## Tasks & Deliverables
| Task | Description | Output |
| --- | --- | --- |
| Signal contracts | Document payloads and listeners for panel open/close + target change | `docs/architecture/Signals_Events.md` entries (completed) |
| StatBus mirror | Describe how `automation_target` is written (replace stack, string enum) | `docs/architecture/StatBus_Catalog.md` + telemetry notes |
| UX flow | Narrative explaining focus handling, copy tone, and animation pacing | This doc + links to `docs/design/UX_Principles.md` |
| Panel + HUD coherence | Show how slot D/F react when automation mode throttles PPS (copy guidelines, tooltip summary) | Cross-links to PX-020.3 + modules |
| Validation notes | Spell out smoke steps (open panel, change targets, verify StatBus + replay output) | Acceptance section (below) |

## Implementation Notes (v20.1)
- Runtime HUD now exposes a dedicated **Automation** button that opens `scenes/ui/panels/AutomationPanel.tscn` (800×480, centered, integer offsets).  The panel emits the same `automation_panel_opened/closed/automation_target_changed` signals as the prototype so `Main.gd`/`AutomationService` stay in sync.
- The **Enable automation** toggle calls `AutomationService.set_global_enabled()` while mirroring state back into the panel and the StatBus/StatsProbe summaries.  Power warnings automatically set the panel’s “limited by power” copy.
- The **Auto-feed threshold** slider (0‑100 %) binds to `Economy.set_automation_feed_threshold()` and `ConveyorManager.set_user_speed_bias()` so PX-020.1 stats and conveyor motion evolve together.  Slider changes are captured in telemetry via the `economy_rate` / backlog labels already logged in PX-020.4.
- Target selection is driven by an `OptionButton` that currently surfaces `economy_feed_autoburst` plus a manual cadence placeholder.  Selection emits `automation_target_changed` and updates `AutomationService.set_panel_target`, keeping `automation_target` entries in StatBus + CSV aligned with HUD state.
- Validation: open the panel via the HUD button or prototype tabs, toggle automation, jog the slider, and confirm `tools/replay_headless.gd` prints the updated `[hud]` labels along with the `automation_target`/`automation_panel_visible`/`tier` fields in the CSV tail.

## Acceptance Criteria
- All panel signals are documented with emitters, payloads, listeners, and frequency expectations.  Example listeners include AutomationService, UIPrototype, and telemetry probes.
- StatBus catalog lists `automation_target` with owner, stack rule, unit, and governance note referencing this PX.  Values are string enums (e.g., `economy_feed_autoburst`) written whenever the user switches targets.
- Interaction narrative details controller + mouse focus order, copy tone, and tooltip sources, with links back to UI and UX docs.
- Validation steps describe how to confirm the panel events reach StatBus (e.g., via replay logs or StatBus inspector) without requiring new code.  Recommended smoke: open the Automation tab, change targets, run `tools/replay_headless.gd` to verify `[hud]` logs and CSV `automation_target` columns.
